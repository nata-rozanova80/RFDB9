# Version4
Версия проекта c ботом в отдельной папке и контроллером

host: IP-адрес для хоста (в данном случае 127.0.0.1)
port: порт для запуска веб-сервера (например, 8001)

Запуск приложения:

Этот код запускается только при выполнении файла напрямую 
(python main.py) благодаря условию if __name__ == "__main__":.

## 1. Управление стартом и завершением:

on_startup и on_shutdown позволяют настроить действия, такие как регистрация вебхука,
очистка ресурсов, логирование и т. д.

## 2. Запуск файла
Запуск осуществляется стандартным способом для Python-скриптов:

python main.py

Этот шаг запустит локальный веб-сервер по адресу
127.0.0.1 (или указанному BOT_HOST) на порту 8001 
(или другом, указанном в BOT_PORT).

## 3. Проверка вебхука
Если ваш бот работает на локальной машине, сервер Telegram 
должен отправлять уведомления по указанному адресу. Однако 
Telegram требует HTTPS, а локальный сервер работает только 
через HTTP.

Что нужно сделать:
### 3.1 Использование сервиса Ngrok для HTTPS
Ngrok позволяет пробросить локальный HTTP-сервер в интернет 
через HTTPS.

Скачайте и установите Ngrok.

Запустите Ngrok, пробрасывая ваш порт:

ngrok http 8001
Ngrok выдаст временный HTTPS URL. Пример:

arduino

https://abc123.ngrok.io


Обновите значение переменной WEBHOOK_URL в вашем коде:

python

WEBHOOK_URL = "https://abc123.ngrok.io/webhook"
Перезапустите бота:

python main.py

## 4. Регистрация вебхука в Telegram
Telegram автоматически зарегистрирует вебхук при старте бота 
через вызов set_webhook, но вы можете проверить это вручную:

Отправьте запрос для установки вебхука:

curl -F "url=https://abc123.ngrok.io/webhook" https://api.telegram.org/bot<TOKEN>/setWebhook
Замените <TOKEN> на ваш токен бота.

Убедитесь, что Telegram возвращает сообщение {"ok": true}. Это означает, 
что вебхук успешно установлен.

## 5. Тестирование
Отправьте сообщение боту через Telegram, чтобы проверить, что он отвечает.
Если бот не отвечает, проверьте логи сервера, которые выводятся в консоли, где запущен main.py.
Убедитесь, что Ngrok все еще работает и ваш HTTPS URL активен.
## 6. Разворачивание на реальном сервере
Для постоянной работы бота через HTTPS рекомендуется развернуть его на сервере с настроенным HTTPS, например:

Варианты:
VPS с настройкой HTTPS (например, Nginx):

Разместите бота на VPS (например, DigitalOcean, AWS, Hetzner).
Настройте веб-сервер (Nginx или Apache) с сертификатом HTTPS (например, Let's Encrypt).
PaaS (например, Heroku, Railway):

Разместите код на PaaS-платформе, которая автоматически предоставляет HTTPS.
Пример настройки Nginx с HTTPS:
nginx
Копировать код
server {
    listen 443 ssl;
    server_name yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;

    location / {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
После настройки сервер будет принимать HTTPS-запросы на https://yourdomain.com/webhook.

## 7. Полезные команды для управления вебхуком
Удалить текущий вебхук:

bash
Копировать код
curl -X POST https://api.telegram.org/bot<TOKEN>/deleteWebhook
Проверить информацию о вебхуке:

bash
Копировать код
curl https://api.telegram.org/bot<TOKEN>/getWebhookInfo
Теперь ваш бот должен быть готов к работе! Если бот работает локально, используйте Ngrok, а для долговременной работы лучше развернуть его на сервере с HTTPS.


## Важные моменты
### Без авторизации ngrok не работает: 
Авторизация обязательна, начиная с версии 3.x.
### Временный туннель: 
Каждый раз, когда вы перезапускаете ngrok, он создаёт новый URL. 
Вам нужно обновлять WEBHOOK_URL в коде.
### Постоянный URL: 
нужен постоянный URL, необходимо приобрести платную подписку на сайте ngrok.



